/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/datatables.net-rowreorder@1.5.0/js/dataTables.rowReorder.mjs
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import t from"jquery";import e from"datatables.net";export{default}from"datatables.net";
/*! RowReorder 1.5.0
 * Â© SpryMedia Ltd - datatables.net/license
 */let o=t;var r=function(t,n){if(!e.versionCheck||!e.versionCheck("1.11"))throw"DataTables RowReorder requires DataTables 1.11 or newer";this.c=o.extend(!0,{},e.defaults.rowReorder,r.defaults,n),this.s={bodyTop:null,dt:new e.Api(t),getDataFn:e.util.get(this.c.dataSrc),middles:null,scroll:{},scrollInterval:null,setDataFn:e.util.set(this.c.dataSrc),start:{top:0,left:0,offsetTop:0,offsetLeft:0,nodes:[],rowIndex:0},windowHeight:0,documentOuterHeight:0,domCloneOuterHeight:0,dropAllowed:!0},this.dom={clone:null,cloneParent:null,dtScroll:o("div.dataTables_scrollBody, div.dt-scroll-body",this.s.dt.table().container())};var s=this.s.dt.settings()[0],i=s.rowreorder;if(i)return i;this.dom.dtScroll.length||(this.dom.dtScroll=o(this.s.dt.table().container(),"tbody")),s.rowreorder=this,this._constructor()};o.extend(r.prototype,{_constructor:function(){var t=this,e=this.s.dt,r=o(e.table().node());"static"===r.css("position")&&r.css("position","relative"),o(e.table().container()).on("mousedown.rowReorder touchstart.rowReorder",this.c.selector,(function(r){if(t.c.enable){if(o(r.target).is(t.c.excludedChildren))return!0;var n=o(this).closest("tr"),s=e.row(n);return s.any()?(t._emitEvent("pre-row-reorder",{node:s.node(),index:s.index()}),t._mouseDown(r,n),!1):void 0}})),e.on("destroy.rowReorder",(function(){o(e.table().container()).off(".rowReorder"),e.off(".rowReorder")})),this._keyup=this._keyup.bind(this)},_cachePositions:function(){var t=this.s.dt,e=o(t.table().node()).find("thead").outerHeight(),r=o.unique(t.rows({page:"current"}).nodes().toArray()),n=o.map(r,(function(t,r){var n=o(t).position().top-e;return(n+n+o(t).outerHeight())/2}));this.s.middles=n,this.s.bodyTop=o(t.table().body()).offset().top,this.s.windowHeight=o(window).height(),this.s.documentOuterHeight=o(document).outerHeight(),this.s.bodyArea=this._calcBodyArea()},_clone:function(t){var e=this.s.dt,r=o(e.table().node().cloneNode(!1)).addClass("dt-rowReorder-float").append("<tbody/>").append(t.clone(!1)),n=t.outerWidth(),s=t.outerHeight(),i=o(o(this.s.dt.table().node()).parent()),d=i.width(),a=i.scrollLeft(),l=t.children().map((function(){return o(this).width()}));r.width(n).height(s).find("tr").children().each((function(t){this.style.width=l[t]+"px"}));var c=o("<div>").addClass("dt-rowReorder-float-parent").width(d).append(r).appendTo("body").scrollLeft(a);this.dom.clone=r,this.dom.cloneParent=c,this.s.domCloneOuterHeight=r.outerHeight()},_clonePosition:function(t){var e,o=this.s.start,r=this._eventToPage(t,"Y")-o.top,n=this._eventToPage(t,"X")-o.left,s=this.c.snapX,i=r+o.offsetTop;e=!0===s?o.offsetLeft:"number"==typeof s?o.offsetLeft+s:n+o.offsetLeft+this.dom.cloneParent.scrollLeft(),i<0?i=0:i+this.s.domCloneOuterHeight>this.s.documentOuterHeight&&(i=this.s.documentOuterHeight-this.s.domCloneOuterHeight),this.dom.cloneParent.css({top:i,left:e})},_emitEvent:function(t,e){var r;return this.s.dt.iterator("table",(function(n,s){var i=o(n.nTable).triggerHandler(t+".dt",e);void 0!==i&&(r=i)})),r},_eventToPage:function(t,e){return-1!==t.type.indexOf("touch")?t.originalEvent.touches[0]["page"+e]:t["page"+e]},_mouseDown:function(t,e){var r=this,n=this.s.dt,s=this.s.start,i=this.c.cancelable,d=e.offset();s.top=this._eventToPage(t,"Y"),s.left=this._eventToPage(t,"X"),s.offsetTop=d.top,s.offsetLeft=d.left,s.nodes=o.unique(n.rows({page:"current"}).nodes().toArray()),this._cachePositions(),this._clone(e),this._clonePosition(t);var a=this._eventToPage(t,"Y")-this.s.bodyTop;s.rowIndex=this._calcRowIndexByPos(a),this.dom.target=e,e.addClass("dt-rowReorder-moving"),o(document).on("mouseup.rowReorder touchend.rowReorder",(function(t){r._mouseUp(t)})).on("mousemove.rowReorder touchmove.rowReorder",(function(t){r._mouseMove(t)})),o(window).width()===o(document).width()&&o(document.body).addClass("dt-rowReorder-noOverflow");var l=this.dom.dtScroll;this.s.scroll={windowHeight:o(window).height(),windowWidth:o(window).width(),dtTop:l.length?l.offset().top:null,dtLeft:l.length?l.offset().left:null,dtHeight:l.length?l.outerHeight():null,dtWidth:l.length?l.outerWidth():null},i&&o(document).on("keyup",this._keyup)},_mouseMove:function(t){this._clonePosition(t);var e=this.s.start,r=this.c.cancelable;if(r){var n=this.s.bodyArea,s=this._calcCloneParentArea();this.s.dropAllowed=this._rectanglesIntersect(n,s),this.s.dropAllowed?o(this.dom.cloneParent).removeClass("drop-not-allowed"):o(this.dom.cloneParent).addClass("drop-not-allowed")}for(var i=this._eventToPage(t,"Y")-this.s.bodyTop,d=this.s.middles,a=null,l=0,c=d.length;l<c;l++)if(i<d[l]){a=l;break}null===a&&(a=d.length),r&&(this.s.dropAllowed||(a=e.rowIndex>this.s.lastInsert?e.rowIndex+1:e.rowIndex),this.dom.target.toggleClass("dt-rowReorder-moving",this.s.dropAllowed)),this._moveTargetIntoPosition(a),this._shiftScroll(t)},_mouseUp:function(t){var e,r,n=this,s=this.s.dt,i=this.c.dataSrc;if(this.s.dropAllowed){var d=this.s.start.nodes,a=o.unique(s.rows({page:"current"}).nodes().toArray()),l={},c=[],h=[],u=this.s.getDataFn,f=this.s.setDataFn;for(e=0,r=d.length;e<r;e++)if(d[e]!==a[e]){var w=s.row(a[e]).id(),p=s.row(a[e]).data(),m=s.row(d[e]).data();w&&(l[w]=u(m)),c.push({node:a[e],oldData:u(p),newData:u(m),newPosition:e,oldPosition:o.inArray(a[e],d)}),h.push(a[e])}var g=[c,{dataSrc:i,nodes:h,values:l,triggerRow:s.row(this.dom.target),originalEvent:t}];if(!1!==this._emitEvent("row-reorder",g)){this._cleanupDragging();var v=function(){if(n.c.update){for(e=0,r=c.length;e<r;e++){var t=s.row(c[e].node).data();f(t,c[e].newData),s.columns().every((function(){this.dataSrc()===i&&s.cell(c[e].node,this.index()).invalidate("data")}))}n._emitEvent("row-reordered",g),s.draw(!1)}};this.c.editor?(this.c.enable=!1,this.c.editor.edit(h,!1,o.extend({submit:"changed"},this.c.formOptions)).multiSet(i,l).one("preSubmitCancelled.rowReorder",(function(){n.c.enable=!0,n.c.editor.off(".rowReorder"),s.draw(!1)})).one("submitUnsuccessful.rowReorder",(function(){s.draw(!1)})).one("submitSuccess.rowReorder",(function(){v()})).one("submitComplete",(function(){n.c.enable=!0,n.c.editor.off(".rowReorder")})).submit()):v()}else n._cancel()}else n._cancel()},_moveTargetIntoPosition:function(t){var e=this.s.dt;if(null===this.s.lastInsert||this.s.lastInsert!==t){var r=o.unique(e.rows({page:"current"}).nodes().toArray()),n="";t>this.s.lastInsert?(this.dom.target.insertAfter(r[t-1]),n="after"):(this.dom.target.insertBefore(r[t]),n="before"),this._cachePositions(),this.s.lastInsert=t,this._emitEvent("row-reorder-changed",{insertPlacement:n,insertPoint:t,row:e.row(this.dom.target)})}},_cleanupDragging:function(){var t=this.c.cancelable;this.dom.clone.remove(),this.dom.cloneParent.remove(),this.dom.clone=null,this.dom.cloneParent=null,this.dom.target.removeClass("dt-rowReorder-moving"),o(document).off(".rowReorder"),o(document.body).removeClass("dt-rowReorder-noOverflow"),clearInterval(this.s.scrollInterval),this.s.scrollInterval=null,t&&o(document).off("keyup",this._keyup)},_shiftScroll:function(t){var e,r,n=this,s=this.s.scroll,i=!1,d=t.pageY-document.body.scrollTop;d<o(window).scrollTop()+65?e=-5:d>s.windowHeight+o(window).scrollTop()-65&&(e=5),null!==s.dtTop&&t.pageY<s.dtTop+65?r=-5:null!==s.dtTop&&t.pageY>s.dtTop+s.dtHeight-65&&(r=5),e||r?(s.windowVert=e,s.dtVert=r,i=!0):this.s.scrollInterval&&(clearInterval(this.s.scrollInterval),this.s.scrollInterval=null),!this.s.scrollInterval&&i&&(this.s.scrollInterval=setInterval((function(){if(s.windowVert){var t=o(document).scrollTop();if(o(document).scrollTop(t+s.windowVert),t!==o(document).scrollTop()){var e=parseFloat(n.dom.cloneParent.css("top"));n.dom.cloneParent.css("top",e+s.windowVert)}}if(s.dtVert){var r=n.dom.dtScroll[0];s.dtVert&&(r.scrollTop+=s.dtVert)}}),20))},_calcBodyArea:function(t){var e=this.s.dt,r=o(e.table().body()).offset();return{left:r.left,top:r.top,right:r.left+o(e.table().body()).width(),bottom:r.top+o(e.table().body()).height()}},_calcCloneParentArea:function(t){var e=o(this.dom.cloneParent).offset();return{left:e.left,top:e.top,right:e.left+o(this.dom.cloneParent).width(),bottom:e.top+o(this.dom.cloneParent).height()}},_rectanglesIntersect:function(t,e){return!(t.left>=e.right||e.left>=t.right||t.top>=e.bottom||e.top>=t.bottom)},_calcRowIndexByPos:function(t){var e=this.s.dt,r=o.unique(e.rows({page:"current"}).nodes().toArray()),n=-1,s=o(e.table().node()).find("thead").outerHeight();return o.each(r,(function(e,r){var i=o(r).position().top-s,d=i+o(r).outerHeight();t>=i&&t<=d&&(n=e)})),n},_keyup:function(t){this.c.cancelable&&27===t.which&&(t.preventDefault(),this._cancel())},_cancel:function(){var t=this.s.start,e=t.rowIndex>this.s.lastInsert?t.rowIndex+1:t.rowIndex;this._moveTargetIntoPosition(e),this._cleanupDragging(),this._emitEvent("row-reorder-canceled",[this.s.start.rowIndex])}}),r.defaults={dataSrc:0,editor:null,enable:!0,formOptions:{},selector:"td:first-child",snapX:!1,update:!0,excludedChildren:"a",cancelable:!1};var n=o.fn.dataTable.Api;n.register("rowReorder()",(function(){return this})),n.register("rowReorder.enable()",(function(t){return void 0===t&&(t=!0),this.iterator("table",(function(e){e.rowreorder&&(e.rowreorder.c.enable=t)}))})),n.register("rowReorder.disable()",(function(){return this.iterator("table",(function(t){t.rowreorder&&(t.rowreorder.c.enable=!1)}))})),r.version="1.5.0",o.fn.dataTable.RowReorder=r,o.fn.DataTable.RowReorder=r,o(document).on("init.dt.dtr",(function(t,n,s){if("dt"===t.namespace){var i=n.oInit.rowReorder,d=e.defaults.rowReorder;if(i||d){var a=o.extend({},i,d);!1!==i&&new r(n,a)}}}));
