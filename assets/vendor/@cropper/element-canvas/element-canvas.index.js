/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@cropper/element-canvas@2.0.0/dist/element-canvas.esm.raw.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import t from"@cropper/element";import{CROPPER_CANVAS as e,ACTION_NONE as n,on as i,EVENT_POINTER_DOWN as s,EVENT_POINTER_MOVE as o,EVENT_POINTER_UP as a,EVENT_WHEEL as r,off as h,isNumber as c,isElement as l,ATTRIBUTE_ACTION as d,EVENT_ACTION_START as p,EVENT_ACTION_MOVE as u,ACTION_TRANSFORM as $,EVENT_ACTION as g,EVENT_ACTION_END as b,ACTION_SCALE as f,isString as m,isPlainObject as w,isPositiveNumber as P,getAdjustedSizes as M,CROPPER_IMAGE as v,isFunction as Y,ACTION_ROTATE as X}from"@cropper/utils";class D extends t{constructor(){super(...arguments),this.$onPointerDown=null,this.$onPointerMove=null,this.$onPointerUp=null,this.$onWheel=null,this.$wheeling=!1,this.$pointers=new Map,this.$style=':host{display:block;min-height:100px;min-width:200px;overflow:hidden;position:relative;touch-action:none;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;user-select:none}:host([background]){background-color:#fff;background-image:repeating-linear-gradient(45deg,#ccc 25%,transparent 0,transparent 75%,#ccc 0,#ccc),repeating-linear-gradient(45deg,#ccc 25%,transparent 0,transparent 75%,#ccc 0,#ccc);background-image:repeating-conic-gradient(#ccc 0 25%,#fff 0 50%);background-position:0 0,.5rem .5rem;background-size:1rem 1rem}:host([disabled]){pointer-events:none}:host([disabled]):after{bottom:0;content:"";cursor:not-allowed;display:block;left:0;pointer-events:none;position:absolute;right:0;top:0}',this.$action=n,this.background=!1,this.disabled=!1,this.scaleStep=.1,this.themeColor="#39f"}static get observedAttributes(){return super.observedAttributes.concat(["background","disabled","scale-step"])}connectedCallback(){super.connectedCallback(),this.disabled||this.$bind()}disconnectedCallback(){this.disabled||this.$unbind(),super.disconnectedCallback()}$propertyChangedCallback(t,e,n){if(!Object.is(n,e)&&(super.$propertyChangedCallback(t,e,n),"disabled"===t))n?this.$unbind():this.$bind()}$bind(){this.$onPointerDown||(this.$onPointerDown=this.$handlePointerDown.bind(this),i(this,s,this.$onPointerDown)),this.$onPointerMove||(this.$onPointerMove=this.$handlePointerMove.bind(this),i(this.ownerDocument,o,this.$onPointerMove)),this.$onPointerUp||(this.$onPointerUp=this.$handlePointerUp.bind(this),i(this.ownerDocument,a,this.$onPointerUp)),this.$onWheel||(this.$onWheel=this.$handleWheel.bind(this),i(this,r,this.$onWheel,{passive:!1,capture:!0}))}$unbind(){this.$onPointerDown&&(h(this,s,this.$onPointerDown),this.$onPointerDown=null),this.$onPointerMove&&(h(this.ownerDocument,o,this.$onPointerMove),this.$onPointerMove=null),this.$onPointerUp&&(h(this.ownerDocument,a,this.$onPointerUp),this.$onPointerUp=null),this.$onWheel&&(h(this,r,this.$onWheel,{capture:!0}),this.$onWheel=null)}$handlePointerDown(t){const{buttons:e,button:n,type:i}=t;if(this.disabled||("pointerdown"===i&&"mouse"===t.pointerType||"mousedown"===i)&&(c(e)&&1!==e||c(n)&&0!==n||t.ctrlKey))return;const{$pointers:s}=this;let o="";if(t.changedTouches)Array.from(t.changedTouches).forEach((({identifier:t,pageX:e,pageY:n})=>{s.set(t,{startX:e,startY:n,endX:e,endY:n})}));else{const{pointerId:e=0,pageX:n,pageY:i}=t;s.set(e,{startX:n,startY:i,endX:n,endY:i})}s.size>1?o=$:l(t.target)&&(o=t.target.action||t.target.getAttribute(d)||""),!1!==this.$emit(p,{action:o,relatedEvent:t})&&(t.preventDefault(),this.$action=o,this.style.willChange="transform")}$handlePointerMove(t){const{$action:e,$pointers:i}=this;if(this.disabled||e===n||0===i.size)return;if(!1===this.$emit(u,{action:e,relatedEvent:t}))return;if(t.preventDefault(),t.changedTouches)Array.from(t.changedTouches).forEach((({identifier:t,pageX:e,pageY:n})=>{const s=i.get(t);s&&Object.assign(s,{endX:e,endY:n})}));else{const{pointerId:e=0,pageX:n,pageY:s}=t,o=i.get(e);o&&Object.assign(o,{endX:n,endY:s})}const s={action:e,relatedEvent:t};if(e===$){const e=new Map(i);let o=0,a=0,r=0,h=0,c=t.pageX,l=t.pageY;i.forEach(((t,n)=>{e.delete(n),e.forEach((e=>{let n=e.startX-t.startX,i=e.startY-t.startY,s=e.endX-t.endX,d=e.endY-t.endY,p=0,u=0,$=0,g=0;if(0===n?i<0?$=2*Math.PI:i>0&&($=Math.PI):n>0?$=Math.PI/2+Math.atan(i/n):n<0&&($=1.5*Math.PI+Math.atan(i/n)),0===s?d<0?g=2*Math.PI:d>0&&(g=Math.PI):s>0?g=Math.PI/2+Math.atan(d/s):s<0&&(g=1.5*Math.PI+Math.atan(d/s)),g>0||$>0){const n=g-$,i=Math.abs(n);i>o&&(o=i,r=n,c=(t.startX+e.startX)/2,l=(t.startY+e.startY)/2)}if(n=Math.abs(n),i=Math.abs(i),s=Math.abs(s),d=Math.abs(d),n>0&&i>0?p=Math.sqrt(n*n+i*i):n>0?p=n:i>0&&(p=i),s>0&&d>0?u=Math.sqrt(s*s+d*d):s>0?u=s:d>0&&(u=d),p>0&&u>0){const n=(u-p)/p,i=Math.abs(n);i>a&&(a=i,h=n,c=(t.startX+e.startX)/2,l=(t.startY+e.startY)/2)}}))}));const d=o>0,p=a>0;d&&p?(s.rotate=r,s.scale=h,s.centerX=c,s.centerY=l):d?(s.action=X,s.rotate=r,s.centerX=c,s.centerY=l):p?(s.action=f,s.scale=h,s.centerX=c,s.centerY=l):s.action=n}else{const[t]=Array.from(i.values());Object.assign(s,t)}i.forEach((t=>{t.startX=t.endX,t.startY=t.endY})),s.action!==n&&this.$emit(g,s,{cancelable:!1})}$handlePointerUp(t){const{$action:e,$pointers:i}=this;if(!this.disabled&&e!==n&&!1!==this.$emit(b,{action:e,relatedEvent:t})){if(t.preventDefault(),t.changedTouches)Array.from(t.changedTouches).forEach((({identifier:t})=>{i.delete(t)}));else{const{pointerId:e=0}=t;i.delete(e)}0===i.size&&(this.style.willChange="",this.$action=n)}}$handleWheel(t){if(this.disabled)return;if(t.preventDefault(),this.$wheeling)return;this.$wheeling=!0,setTimeout((()=>{this.$wheeling=!1}),50);const e=(t.deltaY>0?-1:1)*this.scaleStep;this.$emit(g,{action:f,scale:e,relatedEvent:t},{cancelable:!1})}$setAction(t){return m(t)&&(this.$action=t),this}$toCanvas(t){return new Promise(((e,n)=>{if(!this.isConnected)return void n(new Error("The current element is not connected to the DOM."));const i=document.createElement("canvas");let s=this.offsetWidth,o=this.offsetHeight,a=1;w(t)&&(P(t.width)||P(t.height))&&(({width:s,height:o}=M({aspectRatio:s/o,width:t.width,height:t.height})),a=s/this.offsetWidth),i.width=s,i.height=o;const r=this.querySelector(this.$getTagNameOf(v));r?r.$ready().then((n=>{const h=i.getContext("2d");if(h){const[e,c,l,d,p,u]=r.$getTransform();let $=p,g=u,b=n.naturalWidth,f=n.naturalHeight;1!==a&&($*=a,g*=a,b*=a,f*=a);const m=b/2,P=f/2;h.fillStyle="transparent",h.fillRect(0,0,s,o),w(t)&&Y(t.beforeDraw)&&t.beforeDraw.call(this,h,i),h.save(),h.translate(m,P),h.transform(e,c,l,d,$,g),h.translate(-m,-P),h.drawImage(n,0,0,b,f),h.restore()}e(i)})).catch(n):e(i)}))}}D.$name=e,D.$version="2.0.0";export{D as default};
