/**
 * Bundled by jsDelivr using Rollup v2.79.2 and Terser v5.39.0.
 * Original file: /npm/@cropper/element-viewer@2.0.0/dist/element-viewer.esm.raw.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import e from"@cropper/element";import{CROPPER_VIEWER as t,CROPPER_SELECTION as s,isElement as i,on as a,EVENT_CHANGE as o,CROPPER_CANVAS as n,CROPPER_IMAGE as h,EVENT_LOAD as r,EVENT_TRANSFORM as c,off as l}from"@cropper/utils";const $=new WeakMap,g=new WeakMap,m=new WeakMap,d=new WeakMap,u="both",f="horizontal",S="vertical",I="none";class p extends e{constructor(){super(...arguments),this.$onSelectionChange=null,this.$onSourceImageLoad=null,this.$onSourceImageTransform=null,this.$scale=1,this.$style=":host{display:block;height:100%;overflow:hidden;position:relative;width:100%}",this.resize=S,this.selection="",this.slottable=!1}set $image(e){g.set(this,e)}get $image(){return g.get(this)}set $sourceImage(e){d.set(this,e)}get $sourceImage(){return d.get(this)}set $canvas(e){$.set(this,e)}get $canvas(){return $.get(this)}set $selection(e){m.set(this,e)}get $selection(){return m.get(this)}static get observedAttributes(){return super.observedAttributes.concat(["resize","selection"])}connectedCallback(){super.connectedCallback();let e=null;if(e=this.selection?this.ownerDocument.querySelector(this.selection):this.closest(this.$getTagNameOf(s)),i(e)){this.$selection=e,this.$onSelectionChange=this.$handleSelectionChange.bind(this),a(e,o,this.$onSelectionChange);const t=e.closest(this.$getTagNameOf(n));if(t){this.$canvas=t;const e=t.querySelector(this.$getTagNameOf(h));e&&(this.$sourceImage=e,this.$image=e.cloneNode(!0),this.$getShadowRoot().appendChild(this.$image),this.$onSourceImageLoad=this.$handleSourceImageLoad.bind(this),this.$onSourceImageTransform=this.$handleSourceImageTransform.bind(this),a(e.$image,r,this.$onSourceImageLoad),a(e,c,this.$onSourceImageTransform))}this.$render()}}disconnectedCallback(){const{$selection:e,$sourceImage:t}=this;e&&this.$onSelectionChange&&(l(e,o,this.$onSelectionChange),this.$onSelectionChange=null),t&&this.$onSourceImageLoad&&(l(t.$image,r,this.$onSourceImageLoad),this.$onSourceImageLoad=null),t&&this.$onSourceImageTransform&&(l(t,c,this.$onSourceImageTransform),this.$onSourceImageTransform=null),super.disconnectedCallback()}$handleSelectionChange(e){this.$render(e.detail)}$handleSourceImageLoad(){const{$image:e,$sourceImage:t}=this,s=e.getAttribute("src"),i=t.getAttribute("src");i&&i!==s&&(e.setAttribute("src",i),e.$ready((()=>{setTimeout((()=>{this.$render()}),50)})))}$handleSourceImageTransform(e){this.$render(void 0,e.detail.matrix)}$render(e,t){const{$canvas:s,$selection:i}=this;e||i.hidden||(e=i),(!e||0===e.x&&0===e.y&&0===e.width&&0===e.height)&&(e={x:0,y:0,width:s.offsetWidth,height:s.offsetHeight});const{x:a,y:o,width:n,height:h}=e,r={},{clientWidth:c,clientHeight:l}=this;let $=c,g=l,m=NaN;switch(this.resize){case u:m=1,$=n,g=h,r.width=n,r.height=h;break;case f:m=h>0?l/h:0,$=n*m,r.width=$;break;case S:m=n>0?c/n:0,g=h*m,r.height=g;break;default:c>0?m=n>0?c/n:0:l>0&&(m=h>0?l/h:0)}this.$scale=m,this.$setStyles(r),this.$sourceImage&&this.$transformImageByOffset(null!=t?t:this.$sourceImage.$getTransform(),-a,-o)}$transformImageByOffset(e,t,s){const{$image:i,$scale:a,$sourceImage:o}=this;if(o&&i&&a>=0){const[o,n,h,r,c,l]=e,$=(t*r-h*s)/(o*r-h*n),g=(s*o-n*t)/(o*r-h*n),m=o*$+h*g+c,d=n*$+r*g+l;i.$ready((e=>{this.$setStyles.call(i,{width:e.naturalWidth*a,height:e.naturalHeight*a})})),i.$setTransform(o,n,h,r,m*a,d*a)}}}p.$name=t,p.$version="2.0.0";export{u as RESIZE_BOTH,f as RESIZE_HORIZONTAL,I as RESIZE_NONE,S as RESIZE_VERTICAL,p as default};
